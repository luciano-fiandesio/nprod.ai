---
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/ui/button.astro';
import Input from '../components/ui/input.astro';
import Textarea from '../components/ui/textarea.astro';
import Label from '../components/ui/label.astro';
import SiteFooter from '../components/SiteFooter.astro';
import { CONTACT_EMAIL } from '../data/company';
---

<BaseLayout title="nprod.ai — Intelligent product teams on demand" description="nprod.ai builds AI-native products for ambitious teams.">
  <main class="relative isolate flex min-h-screen flex-col overflow-hidden">
    <div class="absolute inset-0 -z-10 opacity-70">
      <div class="absolute -top-32 right-0 h-72 w-72 rounded-full bg-cyan-500/40 blur-[150px]" />
      <div class="absolute bottom-0 left-16 h-64 w-64 rounded-full bg-sky-600/30 blur-[120px]" />
      <div class="absolute top-48 left-1/2 h-[360px] w-[360px] -translate-x-1/2 rounded-full border border-cyan-500/20 bg-gradient-to-b from-transparent via-cyan-500/10 to-transparent blur-[70px]" />
    </div>

    <header class="mx-auto flex w-full max-w-4xl flex-1 flex-col items-center justify-center px-6 py-24 text-center sm:px-8 lg:px-10">
      <div class="mb-8 flex items-center gap-2 rounded-full border border-border/60 bg-secondary/40 px-4 py-1 text-xs uppercase tracking-[0.35em] text-primary">
        <span>Indipendent AI & Software studio</span>
      </div>
      <h1 class="text-balance text-5xl font-semibold tracking-tight text-foreground sm:text-6xl md:text-7xl">
        nprod.ai
      </h1>
      <p class="mt-6 max-w-2xl text-pretty text-lg text-muted-foreground sm:text-xl">
        Bridging decades of software architecture expertise with today&apos;s AI breakthroughs — building intelligent systems that learn, adapt, and scale.
      </p>
      <div class="mt-12 flex flex-col items-center gap-4 sm:flex-row">
        <Button size="lg" type="button" data-open-modal="contact">
          Get in touch
        </Button>
        <a
          class="text-sm text-muted-foreground transition-colors hover:text-foreground"
          href={`mailto:${CONTACT_EMAIL}`}
        >
          Or email us directly — {CONTACT_EMAIL}
        </a>
      </div>
    </header>

    <SiteFooter />
  </main>

  <dialog
    id="contact-modal"
    class="w-full max-w-xl rounded-2xl border border-border/70 bg-card p-0 text-card-foreground shadow-[0_32px_120px_rgba(8,16,28,0.65)] backdrop:bg-slate-950/80"
  >
    <div class="space-y-6 p-8">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold tracking-tight text-foreground">Let&apos;s build what&apos;s next.</h2>
          <p class="mt-2 max-w-sm text-sm text-muted-foreground">
            Share a bit about your product ambitions and we&apos;ll reach out within one business day.
          </p>
        </div>
        <button
          type="button"
          class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-border/70 bg-transparent text-muted-foreground transition hover:text-foreground"
          data-close-modal
          aria-label="Close contact form"
        >
          &times;
        </button>
      </div>

      <!-- Success message -->
      <div id="success-message" class="hidden rounded-lg border border-green-500/30 bg-green-500/10 p-4 text-sm text-green-400">
        <p class="font-medium">Message sent successfully!</p>
        <p class="mt-1 text-green-400/80">We'll get back to you within one business day.</p>
      </div>

      <!-- Error message -->
      <div id="error-message" class="hidden rounded-lg border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-400">
        <p class="font-medium">Something went wrong</p>
        <p class="mt-1 text-red-400/80">Please try again or email us directly at <a href={`mailto:${CONTACT_EMAIL}`} class="underline">{CONTACT_EMAIL}</a></p>
      </div>

      <form
        id="contact-form"
        class="space-y-5"
        action="https://api.web3forms.com/submit"
        method="POST"
      >
        <!-- Web3Forms Configuration -->
        <input type="hidden" name="access_key" value="9e552d9d-3820-4a80-96f6-e32b2650de07" />
        <input type="hidden" name="subject" value="nprod.ai — new project inquiry" />
        <input type="hidden" name="from_name" value="nprod.ai Contact Form" />

        <!-- Honeypot spam protection -->
        <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />

        <div class="grid gap-2">
          <Label for="name">Name</Label>
          <Input id="name" name="name" placeholder="Your name" required />
        </div>
        <div class="grid gap-2">
          <Label for="email">Email</Label>
          <Input id="email" name="email" type="email" placeholder="you@company.com" required />
        </div>
        <div class="grid gap-2">
          <Label for="message">What are you building?</Label>
          <Textarea
            id="message"
            name="message"
            placeholder="I want to launch an AI-powered..."
            required
          />
        </div>
        <Button type="submit" class="w-full">
          Send
        </Button>
      </form>
    </div>
  </dialog>

  <script is:inline>
    const modal = document.getElementById('contact-modal');
    const openButtons = document.querySelectorAll('[data-open-modal="contact"]');
    const form = document.getElementById('contact-form');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');

    if (modal instanceof HTMLDialogElement) {
      openButtons.forEach((trigger) => {
        trigger.addEventListener('click', () => {
          modal.showModal();
          // Reset messages and form when opening
          successMessage?.classList.add('hidden');
          errorMessage?.classList.add('hidden');
        });
      });

      modal.querySelectorAll('[data-close-modal]').forEach((closeButton) => {
        closeButton.addEventListener('click', () => modal.close());
      });

      modal.addEventListener('click', (event) => {
        const rect = modal.getBoundingClientRect();
        const clickedInDialog =
          event.clientX >= rect.left &&
          event.clientX <= rect.right &&
          event.clientY >= rect.top &&
          event.clientY <= rect.bottom;

        if (!clickedInDialog) {
          modal.close();
        }
      });
    }

    // Handle form submission
    if (form) {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitButton = form.querySelector('button[type="submit"]');
        const originalButtonText = submitButton?.textContent;

        // Hide any previous messages
        successMessage?.classList.add('hidden');
        errorMessage?.classList.add('hidden');

        // Show loading state
        if (submitButton) {
          submitButton.disabled = true;
          submitButton.textContent = 'Sending...';
        }

        try {
          const formData = new FormData(form);
          const response = await fetch('https://api.web3forms.com/submit', {
            method: 'POST',
            body: formData
          });

          const data = await response.json();

          if (data.success) {
            // Show success message
            successMessage?.classList.remove('hidden');
            form.reset();

            // Auto-close modal after 3 seconds
            setTimeout(() => {
              modal?.close();
              successMessage?.classList.add('hidden');
            }, 3000);
          } else {
            // Show error message
            errorMessage?.classList.remove('hidden');
          }
        } catch (error) {
          // Show error message on network failure
          errorMessage?.classList.remove('hidden');
        } finally {
          // Restore button state
          if (submitButton) {
            submitButton.disabled = false;
            submitButton.textContent = originalButtonText || 'Send';
          }
        }
      });
    }
  </script>
</BaseLayout>
